{% set cfg = cfg or {} %}
{% set branding = branding or cfg.get('branding', {}) %}
{% set show_card_signature = show_card_signature if show_card_signature is defined else true %}
<script>
  document.documentElement.style.setProperty('--gp-photo-w', '120px');
  document.documentElement.style.setProperty('--gp-photo-h', '120px');
  document.documentElement.style.setProperty('--gp-qr', '120px');
</script>
<div class="gp-card">
  <div class="gp-header">
      {% set raw_logo = branding.company_logo_url or cfg.get('logo_url') %} {% if
    raw_logo %} {% if raw_logo.startswith('http') %}
    <img src="{{ raw_logo }}" class="gp-logo" alt="logo" />
    {% else %} {% set logo_path = raw_logo.split('/static/')[-1] %}
    <img
      src='{{ url_for("static", path=logo_path) }}'
      class="gp-logo"
      alt="logo"
    />
    {% endif %} {% endif %} {% if branding.company_name %}
    <h5 class="gp-company">{{ branding.company_name }}</h5>
    {% endif %} {% if branding.site_name %}
    <div class="gp-site">{{ branding.site_name }}</div>
    {% endif %}
  </div>
  <div class="gp-body">
    <div class="gp-media">
      <div class="gp-photo">
        {% if rec.image %}
        <img
          id="prevPhoto"
          src="data:image/jpeg;base64,{{ rec.image }}"
          alt="photo"
        />
        {% else %}
        <div class="d-flex align-items-center justify-content-center w-100 h-100 bg-light text-secondary rounded">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
            <path fill-rule="evenodd" d="M8 9a5 5 0 0 0-4.546 2.916 1.05 1.05 0 0 0 .02 1.036C3.888 13.6 5.388 15 8 15s4.112-1.4 4.526-2.048a1.05 1.05 0 0 0 .02-1.036A5 5 0 0 0 8 9z"/>
          </svg>
        </div>

        {% endif %}
      </div>
      <div class="gp-qr">
        {% if qr_img %}
        <img id="qr" src="{{ qr_img }}" alt="qr code" />
        {% else %}
        <div class="qr-placeholder">QR unavailable</div>
        {% endif %}
      </div>
    </div>
    <div class="gp-details">
      <div class="gp-row">
        <span class="gp-label">Name</span>
        <span id="pName" class="gp-value" title="{{ rec.name or '' }}"
          >{{ rec.name or '' }}</span
        >
      </div>
      <div class="gp-row">
        <span class="gp-label">Phone</span>
        <span id="pPhone" class="gp-value" title="{{ rec.phone or '' }}"
          >{{ rec.phone or '' }}</span
        >
      </div>
      <div class="gp-row">
        <span class="gp-label">Email</span>
        <span id="pEmail" class="gp-value" title="{{ rec.email or '—' }}"
          >{{ rec.email or '—' }}</span
        >
      </div>
      <div class="gp-row">
        <span class="gp-label">Visitor Type</span>
        <span id="pType" class="gp-value" title="{{ rec.visitor_type or '—' }}"
          >{{ rec.visitor_type or '—' }}</span
        >
      </div>
      <div class="gp-row">
        <span class="gp-label">Company</span>
        <span id="pCompany" class="gp-value" title="{{ rec.company or '—' }}"
          >{{ rec.company or '—' }}</span
        >
      </div>
      <div class="gp-row">
        <span class="gp-label">Host</span>
        <span id="pHost" class="gp-value" title="{{ rec.host or '' }}"
          >{{ rec.host or '' }}</span
        >
      </div>
      <div class="gp-row">
        <span class="gp-label">Purpose</span>
        <span id="pPurpose" class="gp-value" title="{{ rec.purpose or '' }}"
          >{{ rec.purpose or '' }}</span
        >
      </div>
      {% if rec.id_proof_type %}
      <div class="gp-row">
        <span class="gp-label">ID Type</span>
          <span class="gp-value" title="{{ rec.id_proof_type or '' }}"
            >{{ rec.id_proof_type or '' }}</span
          >
      </div>
      {% endif %}
      <div class="gp-row">
        <span class="gp-label">Gate ID</span>
        <span id="pGate" class="gp-value" title="{{ rec.gate_id or '' }}"
          >{{ rec.gate_id or '' }}</span
        >
      </div>
      <div class="gp-row">
        <span class="gp-label">Entry Time</span>
        <span class="gp-value" title="{{ rec.time or '' }}">{{ rec.time or '' }}</span>
      </div>
      <div class="gp-row">
        <span class="gp-label">Valid Until</span>
        <span id="pValid" class="gp-value" title="{{ rec.valid_to_str or '—' }}"
          >{{ rec.valid_to_str or '—' }}</span
        >
      </div>
    </div>
    <div class="gp-status-wrap">
        <span
          id="pStatus"
          class="badge bg-{{ status_color }} text-uppercase gp-status"
          >{{ rec.status or '' }}</span
        >
    </div>
    {% if show_card_signature and (signature_url or rec.signature) %}
    <div class="gp-signature">
      <img src='{{ (signature_url or rec.signature) | default("", true) }}' alt="signature" />
    </div>
    {% endif %}

  </div>
    {% set footer_logo = branding.footer_logo_url or cfg.get('logo2_url') %} {% if
  footer_logo %}
  <div class="gp-footer">
    {% if footer_logo.startswith('http') %}
    <img src="{{ footer_logo }}" class="gp-footer-logo" alt="footer logo" />
    {% else %} {% set footer_path = footer_logo.split('/static/')[-1] %}
    <img
      src='{{ url_for("static", path=footer_path) }}'
      class="gp-footer-logo"
      alt="footer logo"
    />
    {% endif %}
  </div>
  {% endif %}
</div>
